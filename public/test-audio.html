<!DOCTYPE html>
<html>
<head>
    <title>System Audio Capture Test</title>
</head>
<body>
    <h1>System Audio Capture Test</h1>
    <button id="startBtn">Start Capturing</button>
    <button id="stopBtn" disabled>Stop Capturing</button>
    <div id="status">Status: Idle</div>
    <div id="transcript">Transcript: </div>
    <script>
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const transcript = document.getElementById('transcript');

        let recognition = null;
        let cleanup = null;

        async function setupRecognition() {
            const { setupSpeechRecognition } = await import('/src/services/aiService.js');
            const result = setupSpeechRecognition(
                () => {
                    status.textContent = 'Status: Started';
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                },
                (text) => {
                    transcript.textContent = 'Transcript: ' + text;
                },
                (error) => {
                    status.textContent = 'Status: Error - ' + error;
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                },
                () => {
                    status.textContent = 'Status: Ended';
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                }
            );
            recognition = result.recognition;
            cleanup = result.cleanup;
        }

        startBtn.onclick = async () => {
            if (!recognition) {
                await setupRecognition();
            }
            try {
                recognition.start();
            } catch (error) {
                console.error('Error starting recognition:', error);
            }
        };

        stopBtn.onclick = () => {
            if (cleanup) {
                cleanup();
            }
        };
    </script>
</body>
</html>
